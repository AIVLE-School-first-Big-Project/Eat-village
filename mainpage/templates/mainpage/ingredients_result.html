{% load static%}

<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" type="text/css" href='{% static "aa.css" %}? after'>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="apple-touch-icon" href="/custom_icon.png"/>
    <script src="https://kit.fontawesome.com/312926fc77.js" crossorigin="anonymous"></script>
    <title>Ingredient Result Page</title>
</head>
<body>
    {% include "mainpage/header.html" %}

    {% comment %} <div style="height:100px;">
        <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
            <div class="navbar_logo">
                <a href="{% url 'mainpage:mainpage' %}">
                    <img src="{% static 'logo.png' %}">
                </a>
            </div>
            {% if user.is_authenticated %}
                <p>{{request.user.first_name}}님 환영합니다.</p>
                <a href="{% url 'users:logout' %}"><button> 로그아웃 </button> </a>
            {% else %}
                <p> 로그인 해야 이용 가능합니다 </p>
                <a href="{% url 'users:login' %}"><button> 로그인 </button> </a>
            {% endif %}
            <ul class="navbar_menu">
                <li><a href="{% url 'mypage:main' %}">마이페이지</a></li>
                <li><a href=''>나눔 게시판</a></li>
                <li><a href="{% url 'recipeboard:recipeboard_index' %}">레시피 게시판</a></li>
                <li><a href="{% url 'communityboard:communityboard_index' %}">커뮤니티 게시판</a></li>
            </ul>
            <div class="navbar_right">
                <div class="search">
                    <input id='searchfield' type='text' max_length=255 autocomplete='off'>
                    <button class='searchbtn' onclick="search_recipe(); return false;">검색</button>
                </div>
                <a href="{% url 'mainpage:mainpage' %}#slideShow" class="weather">
                    <div class="temp"></div>
                    <div class="icon"></div>
                </a>
            </div>
            <a href='#' class="navbar_togglebtn">
                <i class="fas fa-bars"></i>
            </a>
        </nav>
    </div> {% endcomment %}



    {% include "mainpage/header.html" %}
    
    <div id='ingredient_container', class = 'recipe-form'>
        <div class="area">
            {% if user.is_authenticated %}
                <h3>{{request.user.username}}<img class = per src="{% static 'per1.png' %}"></h3><br><p> <img class = alle src="{% static 'all1.png' %}"> <br><br> {{request.user.allergyinfo}}</p>
            {% else %}
                <p> 로그인 해야 이용 가능합니다 </p>
            {% endif %}
        </div>
        <br>
    <div class = 'recipe2-form'>
        <div class="area2">
            <p><img class = ing src="{% static 'ing1.png' %}"> <br><br> {{ user_data }}</p>        
        </div>

        <div class="area3" id='ingredient_result' >
            <p> 사용자 추가 식재료 </p>
            <ul id='ingredient_list'>
            </ul>
        </div>

        <div id="button" >
            <button id="btn1"class="w-btn w-btn-indigo2" onclick="ingred_change();">재료 수정</button>
            <button id="btn2"class="w-btn w-btn-indigo" onclick="ingred_recipe();">레시피 추천</button>
        </div>
    </div>

    
</div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="{% static 'main.js' %}"></script>
    <script>
        /* 위치기반 현재 날씨 정보 */
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition((pos) => {
                let lat = pos.coords.latitude;
                let lon = pos.coords.longitude;
                console.log(lat, lon);
                $.getJSON(
                    'https://api.openweathermap.org/data/2.5/weather?lat=' + lat + '&lon=' + lon + '&appid=7d5fba451f0f0e3d56dc8bfbd6263516&units=metric&lang=ko',
                    function(result) {
                    $('.temp').append(result.main.temp + '℃');
                    var weathericon = '<img src="http://openweathermap.org/img/wn/' + result.weather[0].icon + '.png" alt="' + result.weather[0].description + '">';
                    $('.icon').html(weathericon);
                });
            }), (err) => {
                console.log('GPS를 사용할 수 없습니다.');
            };
        };

        /* 레시피 검색 */
        function search_recipe() {
            var food_cate = document.getElementById('searchfield').value;
            if (food_cate.length == 0) { return false;}
            location.href = "{% url 'mainpage:search' %}";
        }

        /* 재료 베이스 레시피 추천 */
        function ingred_recipe() {
            location.href = "{% url 'mainpage:ingredient_recom' %}";
        }

        /* 재료 수정 페이지 이동 */
        function ingred_change() {
            const ingred_list = document.getElementById('ingredient_list');
            const list_a = ingred_list.getElementsByTagName('li');
            for (let i = 0; i < list_a.length; i++) {
                const ing = list_a[i].innerText;
                window.localStorage.setItem(ing, 1);
            };
            location.href = '{% url "mainpage:ingredient_change" %}';
        }

        /* 재료 수정후 로드 될 때*/
        if (window.localStorage.length > 0) {
            const revised_ingred_list = document.getElementById('ingredient_list');
            revised_ingred_list.innerHTML = null;
            for (let i = 0; i < window.localStorage.length; i++) {
                const ingredItem = document.createElement('li');
                ingredItem.innerText = window.localStorage.key(i);

                revised_ingred_list.appendChild(ingredItem);
            };
            window.localStorage.clear();
        };


    </script>
</body>
</html>